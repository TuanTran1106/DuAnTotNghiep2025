<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Quản Lý Kho - Đồng Hồ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/qrious/dist/qrious.min.js"></script>
    <style>

        body {
            background-color: #e9ecef;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            color: #2d3748;
        }

        .container {
            max-width: 1400px;
        }

        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transition: box-shadow 0.2s, transform 0.3s;
            background-color: #ffffff;
        }

        .card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
            transform: translateY(-5px);
        }

        .table-container {
            background: #ffffff;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            position: relative;
        }

        .product-img {
            width: 50px;
            height: auto;
            border-radius: 8px;
        }

        .btn-custom {
            border-radius: 8px;
            padding: 8px 16px;
            font-weight: 500;
            font-size: 14px;
            transition: background-color 0.2s, color 0.2s;
        }

        .btn-primary {
            background-color: #1e3a8a;
            border-color: #1e3a8a;
        }

        .btn-primary:hover {
            background-color: #1e40af;
            border-color: #1e40af;
        }

        .btn-outline-secondary {
            border-color: #6b7280;
            color: #6b7280;
        }

        .btn-outline-secondary:hover {
            background-color: #6b7280;
            color: #ffffff;
        }

        .btn-lich-su, .import-excel, .add-product {
            font-size: 14px;
            background-color: #ffffff;
            border-color: #6b7280;
        }

        .btn-lich-su:hover, .import-excel:hover, .add-product:hover {
            background-color: #f1f5f9;
            color: #4b5563;
        }

        .modal-content {
            border-radius: 12px;
            border: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .modal-header {
            background-color: #ffffff;
            border-bottom: 1px solid #e5e7eb;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #2d3748;
        }

        .modal-footer {
            background-color: #f8fafc;
            border-top: 1px solid #e5e7eb;
        }

        /* Preserved form CSS from original */
        .form-control, .form-select {
            border-radius: 8px;
            border: 1px solid #d1d5db;
            transition: border-color 0.3s;
        }

        .form-control:focus, .form-select:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-floating:hover > input:not(:focus):not(:placeholder-shown) + label,
        .form-floating:hover > input:not(:focus):placeholder-shown + label {
            transform: scale(0.85) translateY(-1.5rem);
            opacity: 0.85;
            transition: all 0.2s ease;
        }

        .sao {
            color: red;
        }

        .pagination .page-link {
            border-radius: 8px;
            margin: 0 4px;
            color: #1e3a8a;
            font-size: 14px;
        }

        .pagination .page-item.active .page-link {
            background-color: #1e3a8a;
            border-color: #1e3a8a;
            color: #ffffff;
        }

        .loading-overlay {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            z-index: 10;
            justify-content: center;
            align-items: center;
            border-radius: 12px;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #1e3a8a;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .table th {
            background-color: #f8fafc;
            font-weight: 600;
            font-size: 13px;
            color: #4b5563;
            padding: 12px;
        }

        .table td {
            font-size: 14px;
            padding: 12px;
            vertical-align: middle;
        }

        .table-hover tbody tr:hover {
            background-color: #f1f5f9;
        }

        .table-responsive::-webkit-scrollbar {
            width: 6px;
        }

        .table-responsive::-webkit-scrollbar-thumb {
            background-color: #cbd5e0;
            border-radius: 6px;
        }

        .custom-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            min-width: 280px;
            max-width: 400px;
            padding: 15px 20px;
            border-radius: 8px;
            color: #fff;
            font-size: 15px;
            font-weight: 500;
            display: flex;
            align-items: center;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            opacity: 0;
            transform: translateY(-20px);
            animation: slideIn 0.3s ease-out forwards, fadeOut 0.5s ease-in 2s forwards;
        }

        .toast-success {
            background-color: #ffffff;
            color: #218838;
        }

        .toast-error {
            background-color: #ffffff;
            color: red;
        }

        @keyframes slideIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeOut {
            to {
                opacity: 0;
                transform: translateY(-20px);
            }
        }

        .no-data {
            color: rgba(107, 114, 128, 0.6);
            font-style: italic;
            font-size: 1rem;
        }

        .no-data i {
            opacity: 0.6;
            vertical-align: middle;
        }

    </style>
</head>
<body class="antialiased">
<div class="d-flex">
    <div class="flex-1 p-6">
        <div class="container mx-auto">
            <!-- Header -->
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold text-gray-900">Quản Lý Kho</h2>
                <div class="d-flex gap-2">
                    <button class="btn btn-custom btn-lich-su" data-bs-toggle="modal" data-bs-target="#historyModal">
                        Lịch Sử
                    </button>
                    <button class="btn btn-custom import-excel" data-bs-toggle="modal" data-bs-target="#importModal">
                        Nhập Excel
                    </button>
                    <button class="btn btn-custom add-product" data-bs-toggle="modal" data-bs-target="#addProductModal">
                        Thêm Sản Phẩm
                    </button>
                </div>
            </div>

            <!-- header  -->
            <div class="row g-4 mb-6">
                <div class="col-md-3">
                    <div class="card p-4">
                        <h5 class="card-title text-sm font-medium text-gray-600">Tổng Sản Phẩm</h5>
                        <p class="card-text text-2xl font-semibold text-gray-900" th:text="${totalProduct}"></p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card p-4">
                        <h5 class="card-title text-sm font-medium text-gray-600">Tổng Tồn Kho</h5>
                        <p class="card-text text-2xl font-semibold text-gray-900" th:text="${totalProductInSock}"></p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card p-4">
                        <h5 class="card-title text-sm font-medium text-gray-600">Giá Trị Tồn Kho</h5>
                        <p class="card-text text-2xl font-semibold text-gray-900" th:text="${totalPriceInSock}"></p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card p-4">
                        <h5 class="card-title text-sm font-medium text-gray-600">Sắp Hết Hàng</h5>
                        <p class="card-text text-2xl font-semibold text-gray-900" th:text="${totalProductIsOut}"></p>
                    </div>
                </div>
            </div>

            <!-- filter -->
            <div class="table-container mb-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Danh Sách Tồn Kho</h3>
                <form class="row g-3 align-items-end">
                    <div class="col-md-3">
                        <label class="form-label text-sm font-medium">Từ khóa</label>
                        <input style="font-size: 14px" type="text" class="form-control" name="keyword"
                               placeholder="Tên sản phẩm...">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label text-sm font-medium">Thương hiệu</label>
                        <select style="font-size: 14px" class="form-select" name="thuongHieu">
                            <option style="font-size: 14px" value="">-- Tất cả --</option>
                            <option style="font-size: 14px" th:each="brand : ${listBrand}" th:value="${brand.id}"
                                    th:text="${brand.tenThuongHieu}"></option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label text-sm font-medium">Danh mục</label>
                        <select style="font-size: 14px" class="form-select" name="danhMuc">
                            <option style="font-size: 14px" value="">-- Tất cả --</option>
                            <option style="font-size: 14px" th:each="dm : ${listCategory}" th:value="${dm.id}"
                                    th:text="${dm.tenDanhMuc}"></option>
                        </select>
                    </div>
                    <div class="col-md-3 d-flex gap-2">
                        <button style="font-size: 14px" class="btn btn-custom btn-primary btn-filter" type="submit">
                            <i class="bi bi-funnel me-1"></i> Bộ Lọc
                        </button>
                        <a style="font-size: 14px" href="/quan-ly/kho"
                           class="btn btn-custom btn-outline-secondary btn-reset">Reset</a>
                    </div>
                </form>
            </div>

            <!-- conttent table -->
            <div class="table-container" id="table-container">
                <div class="loading-overlay" id="loading-overlay">
                    <div class="loading-spinner"></div>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover align-middle text-center">
                        <thead>
                        <tr>
                            <th class="py-3">#</th>
                            <th>Tên Sản Phẩm</th>
                            <th>Màu Sắc</th>
                            <th>Kích Thước</th>
                            <th>Chất Liệu</th>
                            <th>Giá Nhập</th>
                            <th>Số Lượng Tồn</th>
                            <th>Thương Hiệu</th>
                            <th>Danh Mục</th>
                            <th>Thao Tác</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:if="${listInSock.isEmpty()}">
                            <td colspan="10" class="text-center py-3">
                                <span class="no-data">
                                    <i class="bi bi-database fs-5 me-2"></i>
                                    <em style="font-size: 14px">Không có dữ liệu...</em>
                                </span>
                            </td>
                        </tr>
                        <tr th:each="sock,start : ${listInSock}" th:class="${sock.soLuong <= 10} ? 'bg-red-50'">
                            <td th:text="${start.index + 1}"></td>
                            <td th:text="${sock.tenSanPham}"></td>
                            <td th:text="${sock.mauSac}"></td>
                            <td th:text="${sock.kichThuoc}"></td>
                            <td th:text="${sock.chatLieu}"></td>
                            <td th:text="${#numbers.formatDecimal(sock.giaNhap, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></td>
                            <td class="font-semibold"
                                th:class="${sock.soLuong <= 10} ? 'text-red-600' : 'text-gray-900'"
                                th:text="${sock.soLuong}"></td>
                            <td th:text="${sock.tenThuongHieu}"></td>
                            <td th:text="${sock.tenDanhMuc}"></td>
                            <td class="d-flex gap-2 justify-content-center">
                                <a class="text-primary btn-nhap" href="#" th:attr="data-id=${sock.id}" title="Nhập hàng"
                                   data-bs-placement="top" data-bs-toggle="modal" data-bs-target="#enter">
                                    <i class="bi bi-box-arrow-in-down fs-5"></i>
                                </a>
                                <a class="text-danger btn-xuat" href="#" th:attr="data-id=${sock.id}" title="Xuất hàng"
                                   data-bs-placement="top" data-bs-toggle="modal" data-bs-target="#export">
                                    <i class="bi bi-box-arrow-up fs-5"></i>
                                </a>
                                <a class="text-warning btn-sua" href="#" th:attr="data-id=${sock.id}"
                                   title="Cập nhật số lượng mới" data-bs-placement="top" data-bs-toggle="modal"
                                   data-bs-target="#editModal">
                                    <i class="bi bi-pencil-square fs-5"></i>
                                </a>
                                <a class="text-danger btn-xoa" href="#" th:attr="data-id=${sock.id}"
                                   title="Xóa sản phẩm" data-bs-placement="top" data-bs-toggle="modal"
                                   data-bs-target="#deleteModal">
                                    <i class="bi bi-trash fs-5"></i>
                                </a>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!-- phân trang -->
                <nav class="mt-4">
                    <ul class="pagination justify-content-center">
                        <li class="page-item" th:classappend="${startPage == 0} ? 'disabled'">
                            <a class="page-link" th:href="@{/quan-ly/kho(page=${startPage - 1})}">«</a>
                        </li>
                        <li class="page-item" th:each="i : ${#numbers.sequence(0, totalPage - 1)}"
                            th:classappend="${i == startPage} ? 'active'">
                            <a class="page-link" th:href="@{/quan-ly/kho(page=${i})}" th:text="${i + 1}"></a>
                        </li>
                        <li class="page-item" th:classappend="${startPage == totalPage - 1} ? 'disabled'">
                            <a class="page-link" th:href="@{/quan-ly/kho(page=${startPage + 1})}">»</a>
                        </li>
                    </ul>
                </nav>
            </div>

            <!--modal nhập hàng -->
            <div class="modal fade" id="enter" tabindex="-1">
                <div class="modal-dialog">
                    <form method="post" th:action="@{/quan-ly/kho/nhap}" th:object="${form}" id="formNhap">
                        <input type="hidden" name="id" id="nhap-id">
                        <div class="modal-content border-0 rounded shadow-sm">
                            <div class="modal-header bg-white border-bottom">
                                <h5 class="modal-title text-dark fw-semibold">Nhập Hàng</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Đóng"></button>
                            </div>
                            <div class="modal-body">
                                <div class="form-floating">
                                    <input type="text" class="form-control" id="soLuongNhap" name="soLuong"
                                           placeholder="Số lượng nhập" min="1">
                                    <label style="font-size: 14px" for="soLuongNhap">Số lượng nhập <span
                                            class="text-danger">*</span></label>
                                    <div class="invalid-feedback" id="soLuongNhapError"></div>
                                </div>
                                <div class="form-floating" style="padding-top: 10px">
                                    <input type="text" class="form-control" id="ghiChu" name="ghiChuNhap"
                                           placeholder="Ghi chú">
                                    <label style="font-size: 14px" for="ghiChu">Ghi chú</label>
                                </div>
                            </div>
                            <div class="modal-footer bg-light border-top">
                                <button type="submit" class="btn btn-primary btn-sm">Lưu</button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">
                                    Hủy
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- modalxuaasts hang -->
            <div class="modal fade" id="export" tabindex="-1">
                <div class="modal-dialog">
                    <form method="post" th:action="@{/quan-ly/kho/xuat}" id="formXuat">
                        <input type="hidden" name="id" id="xuat-id">
                        <div class="modal-content border-0 rounded shadow-sm">
                            <div class="modal-header bg-white border-bottom">
                                <h5 class="modal-title text-dark fw-semibold">Xuất Hàng</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Đóng"></button>
                            </div>
                            <div class="modal-body">
                                <div class="form-floating">
                                    <input type="text" class="form-control" id="soLuongXuat" name="soLuong"
                                           placeholder="Số lượng xuất" min="1">
                                    <label style="font-size: 14px" for="soLuongXuat">Số lượng xuất <span
                                            class="text-danger">*</span></label>
                                    <div class="invalid-feedback" id="soLuongXuatError"></div>
                                </div>
                                <div class="form-floating" style="padding-top: 10px">
                                    <input type="text" class="form-control" id="ghiChuXuat" name="ghiChuXuat"
                                           placeholder="Ghi chú">
                                    <label style="font-size: 14px" for="ghiChuXuat">Ghi chú</label>
                                </div>
                            </div>
                            <div class="modal-footer bg-light border-top">
                                <button type="submit" class="btn btn-primary btn-sm">Lưu</button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">
                                    Hủy
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- modal cập nhật s lượng -->
            <div class="modal fade" id="editModal" tabindex="-1">
                <div class="modal-dialog">
                    <form method="post" th:action="@{/quan-ly/kho/sua}" id="formSua">
                        <input type="hidden" name="id" id="sua-id">
                        <div class="modal-content border-0 rounded shadow-sm">
                            <div class="modal-header bg-white border-bottom">
                                <h5 class="modal-title text-dark fw-semibold">Cập Nhật Số Lượng</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Đóng"></button>
                            </div>
                            <div class="modal-body">
                                <div class="form-floating">
                                    <input type="text" class="form-control" id="soLuongMoi" name="soLuong"
                                           placeholder="Số lượng mới" min="0">
                                    <label style="font-size: 14px" for="soLuongMoi">Số lượng mới <span
                                            class="text-danger">*</span></label>
                                    <div class="invalid-feedback" id="soLuongSuaError"></div>
                                </div>
                                <div class="form-floating" style="padding-top: 10px">
                                    <input type="text" class="form-control" id="ghiChuUpdate" name="ghiChuUpdate"
                                           placeholder="Ghi chú">
                                    <label style="font-size: 14px" for="ghiChuUpdate">Ghi chú</label>
                                </div>
                            </div>
                            <div class="modal-footer bg-light border-top">
                                <button type="submit" class="btn btn-primary btn-sm">Lưu</button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">
                                    Hủy
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- modal lịch sử -->
            <div class="modal fade" id="historyModal" tabindex="-1">
                <div class="modal-dialog modal-lg">
                    <input type="hidden" name="id" id="lich-su-id">
                    <div class="modal-content border-0 rounded shadow-sm">
                        <div class="modal-header bg-white border-bottom">
                            <h5 class="modal-title text-dark fw-semibold">Lịch Sử Nhập/Xuất Kho</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
                        </div>
                        <div class="modal-body" style="max-height: 500px; overflow-y: auto;">
                            <div class="table-responsive">
                                <table class="table table-bordered table-hover text-sm text-center align-middle">
                                    <thead class="table-light">
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">Ngày Thực Hiện</th>
                                        <th scope="col">Tên Sản Phẩm</th>
                                        <th scope="col">Người Thực Hiện</th>
                                        <th scope="col">Loại Thao Tác</th>
                                        <th scope="col">Số Lượng</th>
                                        <th scope="col">Ghi Chú</th>
                                    </tr>
                                    </thead>
                                    <tbody id="historyBody">
                                    <tr th:each="history,start : ${listHistoryInSock}">
                                        <td th:text="${start.index + 1}"></td>
                                        <td th:text="${#temporals.format(history.thoiGian, 'dd/MM/yyyy HH:mm:ss')}"></td>
                                        <td th:text="${history.sanPhamChiTiet.sanPham.tenSanPham}"></td>
                                        <td th:text="${history.nhanVien.hoTen}"></td>
                                        <td th:text="${history.loai}"></td>
                                        <td th:text="${history.soLuong}"></td>
                                        <td th:text="${history.ghiChu}"></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="modal-footer bg-light border-top">
                            <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">
                                Đóng
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- modal import excel -->
            <div class="modal fade" id="importModal" tabindex="-1">
                <div class="modal-dialog">
                    <form method="post" enctype="multipart/form-data" th:action="@{/quan-ly/kho/import}">
                        <div class="modal-content border-0 rounded shadow-sm">
                            <div class="modal-header bg-white border-bottom">
                                <h5 class="modal-title text-dark fw-semibold">Nhập Dữ Liệu Từ Excel</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Đóng"></button>
                            </div>
                            <div class="modal-body">
                                <div class="form-floating">
                                    <input style="font-size: 14px" type="file" class="form-control" name="file"
                                           accept=".xlsx,.xls">
                                    <label style="font-size: 14px">Chọn file Excel <span
                                            class="text-danger">*</span></label>
                                </div>
                            </div>
                            <div class="modal-footer bg-light border-top">
                                <button type="submit" class="btn btn-primary btn-sm">Tải Lên</button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">
                                    Hủy
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- modal thêm sản phâm -->
            <div class="modal fade" id="addProductModal" tabindex="-1">
                <div class="modal-dialog">
                    <form method="post" th:action="@{/quan-ly/kho/them}" id="formThem">
                        <div class="modal-content border-0 rounded shadow-sm">
                            <div class="modal-header bg-white border-bottom">
                                <h5 class="modal-title text-dark fw-semibold">Thêm Sản Phẩm</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Đóng"></button>
                            </div>
                            <div class="modal-body">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="tenSanPham" name="tenSanPham" required>
                                    <label for="tenSanPham">Tên sản phẩm <span class="text-danger">*</span></label>
                                </div>
                                <div class="form-floating mb-3">
                                    <select style="font-size: 14px" class="form-select" id="thuongHieu"
                                            name="thuongHieu" required>
                                        <option style="font-size: 14px" value="">-- Chọn thương hiệu --</option>
                                        <option style="font-size: 14px" th:each="brand : ${listBrand}"
                                                th:value="${brand.id}" th:text="${brand.tenThuongHieu}"></option>
                                    </select>
                                    <label for="thuongHieu">Thương hiệu <span class="text-danger">*</span></label>
                                </div>
                                <div class="form-floating mb-3">
                                    <select style="font-size: 14px" class="form-select" id="danhMuc" name="danhMuc"
                                            required>
                                        <option style="font-size: 14px" value="">-- Chọn danh mục --</option>
                                        <option style="font-size: 14px" th:each="dm : ${listCategory}"
                                                th:value="${dm.id}" th:text="${dm.tenDanhMuc}"></option>
                                    </select>
                                    <label for="danhMuc">Danh mục <span class="text-danger">*</span></label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="mauSac" name="mauSac" required>
                                    <label for="mauSac">Màu sắc <span class="text-danger">*</span></label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="kichThuoc" name="kichThuoc" required>
                                    <label for="kichThuoc">Kích thước <span class="text-danger">*</span></label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="chatLieu" name="chatLieu" required>
                                    <label for="chatLieu">Chất liệu <span class="text-danger">*</span></label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="giaNhap" name="giaBan" min="0" required>
                                    <label for="giaNhap">Giá nhập <span class="text-danger">*</span></label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="soLuong" name="soLuong" min="0"
                                           required>
                                    <label for="soLuong">Số lượng <span class="text-danger">*</span></label>
                                </div>
                            </div>
                            <div class="modal-footer bg-light border-top">
                                <button type="submit" class="btn btn-primary">Lưu</button>
                                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Hủy
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- md thông abso -->
            <div class="modal fade" id="notificationModal" tabindex="-1" aria-labelledby="notificationModalLabel"
                 aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content border-0 rounded shadow-sm">
                        <div class="modal-header bg-white border-bottom">
                            <h5 class="modal-title text-dark fw-semibold">Thông Báo</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
                        </div>
                        <div class="modal-body">
                            <div id="notificationMessage" class="text-center"></div>
                        </div>
                        <div class="modal-footer bg-light border-top">
                            <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">
                                Đóng
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!--thong báo lỗi -->
            <div th:if="${successMessage}" class="custom-toast toast-success" id="toastSuccess">
                <i class="fas fa-check-circle toast-icon"></i>
                <span th:text="${successMessage}"></span>
            </div>
            <div th:if="${errorMessage}" class="custom-toast toast-error" id="toastError">
                <i class="fas fa-exclamation-circle toast-icon"></i>
                <span th:text="${errorMessage}"></span>
            </div>

            <!-- modal xác nhận xóa-->
            <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content border-0 rounded shadow-sm">
                        <div class="modal-header bg-white border-bottom-0">
                            <h5 class="modal-title fw-semibold text-dark" id="deleteModalLabel">Xác nhận xóa sản phẩm</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
                        </div>
                        <div class="modal-body text-center px-4">
                            <p class="mb-0 text-secondary">
                                Bạn có chắc chắn muốn xóa sản phẩm này không?
                                <br>
                                <small class="text-muted">Hành động này không thể hoàn tác.</small>
                            </p>
                        </div>
                        <div class="modal-footer bg-light border-top-0 justify-content-center">
                            <form id="deleteForm" th:action="@{/quan-ly/kho/xoa}" method="post" class="d-inline">
                                <input type="hidden" id="xoa-id" name="id">
                                <button type="submit" class="btn btn-primary btn-sm">Xóa</button>
                            </form>
                            <button type="button" class="btn btn-outline-secondary btn-sm ms-2" data-bs-dismiss="modal">Hủy</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
</body>


<script>
    document.addEventListener("DOMContentLoaded", function () {

        // thông báo lỗi
        window.addEventListener('DOMContentLoaded', () => {
            const successAlert = document.getElementById('successAlert');
            const errorAlert = document.getElementById('errorAlert');

            if (successAlert) {
                setTimeout(() => successAlert.style.display = 'none', 5000);
            }

            if (errorAlert) {
                setTimeout(() => errorAlert.style.display = 'none', 5000);
            }
        });

        // mở form
        document.querySelectorAll(".btn-nhap").forEach(btn => {
            btn.addEventListener("click", function () {
                const id = btn.getAttribute("data-id");
                document.getElementById("nhap-id").value = id;
            });
        });

        document.querySelectorAll(".btn-xuat").forEach(btn => {
            btn.addEventListener("click", function () {
                const id = btn.getAttribute("data-id");
                document.getElementById("xuat-id").value = id;
            });
        });

        document.querySelectorAll(".btn-xoa").forEach(btn => {
            btn.addEventListener("click", function () {
                const id = btn.getAttribute("data-id");
                document.getElementById("xoa-id").value = id;
            });
        });

        document.querySelectorAll(".btn-sua").forEach(btn => {
            btn.addEventListener("click", function () {
                const id = btn.getAttribute("data-id");
                document.getElementById("sua-id").value = id;
            });
        });

        document.querySelectorAll(".btn-lich-su").forEach(btn => {
            btn.addEventListener("click", function () {
                const id = btn.getAttribute("data-id");
                document.getElementById("lich-su-id").value = id;
            });
        });

        // loading khi click button
        document.querySelector(".btn-reset").addEventListener("click", function (e) {
            e.preventDefault();
            const loadingOverlay = document.getElementById("loading-overlay");
            loadingOverlay.style.display = "flex";
            setTimeout(() => {
                window.location.href = "/quan-ly/kho";
            }, 700);
        });

        document.querySelector(".btn-filter").addEventListener("click", function (e) {
            e.preventDefault();
            const loadingOverlay = document.getElementById("loading-overlay");
            loadingOverlay.style.display = "flex";
            const form = e.target.closest("form");
            setTimeout(() => {
                form.submit();
            }, 700);
        });

        // lable nút ở table
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[title]'));
        tooltipTriggerList.forEach(function (el) {
            new bootstrap.Tooltip(el);
        });

        const formNhap = document.getElementById('formNhap');
        const soLuongNhap = document.getElementById('soLuongNhap');
        const soLuongNhapError = document.getElementById('soLuongNhapError');

        const formXuat = document.getElementById('formXuat');
        const soLuongXuat = document.getElementById('soLuongXuat');
        const soLuongXuatError = document.getElementById('soLuongXuatError');

        const formSua = document.getElementById('formSua');
        const soLuongMoi = document.getElementById('soLuongMoi');
        const soLuongSuaError = document.getElementById('soLuongSuaError');

        function validateNumber(input, errorElem, min = 1) {
            const value = input.value.trim();
            if (!/^\d+$/.test(value)) {
                errorElem.textContent = 'Vui lòng nhập số nguyên hợp lệ.';
                input.classList.add('is-invalid');
                return false;
            } else if (parseInt(value, 10) < min) {
                errorElem.textContent = `Số lượng phải lớn hơn hoặc bằng ${min}.`;
                input.classList.add('is-invalid');
                return false;
            } else {
                errorElem.textContent = '';
                input.classList.remove('is-invalid');
                return true;
            }
        }

        formNhap.addEventListener('submit', e => {
            if (!validateNumber(soLuongNhap, soLuongNhapError, 1)) {
                e.preventDefault();
            }
        });

        formXuat.addEventListener('submit', e => {
            if (!validateNumber(soLuongXuat, soLuongXuatError, 1)) {
                e.preventDefault();
            }
        });

        formSua.addEventListener('submit', e => {
            if (!validateNumber(soLuongMoi, soLuongSuaError, 0)) {
                e.preventDefault();
            }
        });

        [{input: soLuongNhap, error: soLuongNhapError, min: 1},
            {input: soLuongXuat, error: soLuongXuatError, min: 1},
            {input: soLuongMoi, error: soLuongSuaError, min: 0}]
            .forEach(({input, error, min}) => {
                input.addEventListener('input', () => {
                    validateNumber(input, error, min);
                });
            });

        // auto tìm kiếm
        const keywordInput = document.querySelector('input[name="keyword"]');
        const form = keywordInput.closest('form');
        const loadingOverlay = document.getElementById("loading-overlay");
        const notificationContainer = document.createElement('div');
        notificationContainer.id = 'notification';
        notificationContainer.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 1000; display: none;';
        document.body.appendChild(notificationContainer);

        function showNotification(message, type = 'info') {
            notificationContainer.innerHTML = `
            <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        `;
            notificationContainer.style.display = 'block';
            setTimeout(() => {
                notificationContainer.style.display = 'none';
            }, 1200);
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function reinitializeEvents() {
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[title]'));
            tooltipTriggerList.forEach(function (el) {
                new bootstrap.Tooltip(el);
            });
            document.querySelectorAll(".btn-nhap").forEach(btn => {
                btn.addEventListener("click", function () {
                    document.getElementById("nhap-id").value = btn.getAttribute("data-id");
                });
            });

            document.querySelectorAll(".btn-xoa").forEach(btn => {
                btn.addEventListener("click", function () {
                    document.getElementById("xoa-id").value = btn.getAttribute("data-id");
                });
            });

            document.querySelectorAll(".btn-xuat").forEach(btn => {
                btn.addEventListener("click", function () {
                    document.getElementById("xuat-id").value = btn.getAttribute("data-id");
                });
            });
            document.querySelectorAll(".btn-sua").forEach(btn => {
                btn.addEventListener("click", function () {
                    document.getElementById("sua-id").value = btn.getAttribute("data-id");
                });
            });
            document.querySelectorAll('.pagination .page-link').forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();
                    const url = this.getAttribute('href');
                    loadingOverlay.style.display = "flex";
                    fetch(url, {method: 'GET', headers: {'Accept': 'text/html'}})
                        .then(response => response.text())
                        .then(html => {
                            const parser = new DOMParser();
                            const doc = parser.parseFromString(html, 'text/html');
                            const newContent = doc.querySelector("#table-container").innerHTML;
                            document.getElementById("table-container").innerHTML = newContent;
                            if (!doc.querySelector("#table-container").querySelector('tr')) {
                                showNotification('Không tìm thấy sản phẩm nào', 'warning');
                            }
                            reinitializeEvents();
                            loadingOverlay.style.display = "none";
                        })
                        .catch(error => {
                            console.error('Lỗi:', error);
                            showNotification('Đã xảy ra lỗi khi tải dữ liệu', 'danger');
                            loadingOverlay.style.display = "none";
                        });
                });
            });
        }

        const triggerSearch = debounce(() => {
            loadingOverlay.style.display = "flex";
            const formData = new FormData(form);
            const params = new URLSearchParams(formData).toString();
            fetch(`${form.action}?${params}`, {
                method: 'GET',
                headers: {'Accept': 'text/html'}
            })
                .then(response => response.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const newContent = doc.querySelector("#table-container").innerHTML;
                    document.getElementById("table-container").innerHTML = newContent;
                    if (!doc.querySelector("#table-container").querySelector('tr')) {
                        showNotification('Không tìm thấy sản phẩm nào', 'warning');
                    }
                    reinitializeEvents();
                    loadingOverlay.style.display = "none";
                });
        }, 1200);

        keywordInput.addEventListener('input', triggerSearch);
        document.querySelector(".btn-filter").addEventListener("click", function (e) {
            e.preventDefault();
            triggerSearch();
        });
        document.querySelector(".btn-reset").addEventListener("click", function (e) {
            e.preventDefault();
            loadingOverlay.style.display = "flex";
            fetch('/quan-ly/kho', {method: 'GET', headers: {'Accept': 'text/html'}})
                .then(response => response.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const newContent = doc.querySelector("#table-container").innerHTML;
                    document.getElementById("table-container").innerHTML = newContent;
                    if (!doc.querySelector("#table-container").querySelector('tr')) {
                        showNotification('Không tìm thấy sản phẩm nào', 'warning');
                    }
                    reinitializeEvents();
                    loadingOverlay.style.display = "none";
                    form.reset();
                })
                .catch(error => {
                    console.error('Lỗi:', error);
                    showNotification('Đã xảy ra lỗi khi đặt lại', 'danger');
                    loadingOverlay.style.display = "none";
                });
        });

        reinitializeEvents();


        // cảnh báo hàng ắp hết và gửi mail


    });

</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>